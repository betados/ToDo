<!DOCTYPE html PUBLIC "a" "b">
<meta charset="UTF-8"/>
<html>
<head>
    <title>TODO LIST</title>
</head>
<body>
<p id="tasks" hidden="hidden">{{tasks}}</p>
<p id="q" hidden="hidden">{{q}}</p>
<p id="salida"></p>

<!--FIXME la funcion deleteTask no borra estas etiquetas-->
{% for i in q %}
<p id="task{{i}}" onclick="deleteTask(id)"></p>
{% endfor %}

<script type="text/javascript">


                function deleteTask(id) {
                    document.getElementById(id).style.color = "red";
                    var req = new XMLHttpRequest()
                    req.onreadystatechange = function(){
                        if (req.readyState == 4){
                            if (req.status != 200){
                                //error handling code here
                            }
                            else{
                                var response = JSON.parse(req.responseText)
                                document.getElementById("tasks").innerHTML = response.tasks
                                init();
                            }
                        }
                    }
                    req.open('POST', '/ajax')
                    req.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
                    var postVars = "task="+document.getElementById(id).innerHTML
                    req.send(postVars)
                    return false
                    <!--TODO meter llamada al back end para que la borre de la base de datos-->
                }
                function init(){
                    var tasksArray = document.getElementById("tasks").innerHTML.split(";");
                    <!--document.getElementById("salida").innerHTML = tasksArray;-->
                    for (var i = 0; i < tasksArray.length; i++){
                        printTask(tasksArray[i], i);
                    }
                }
                function printTask(t, i){
                    document.getElementById("task" + i).innerHTML = t;
                }
                <!--init();-->
                <!--window.onclick();-->
                window.onload(init());

</script>

<form action="" method="post">
    {{ form.csrf }}

    <div class="input text">
        {{ form.description.label }} {{ form.description }}
    </div>

    <div class="input submit">
        <input type="submit" value="Crear nueva tarea"/>
    </div>
</form>

</body>
</html>